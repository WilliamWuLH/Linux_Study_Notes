# Vim文本编辑器

[TOC]

Vim 是所有 Linux 发行版本默认的文本编辑器。

很多人习惯将 Vim 称为 Vi，其实 **Vim 是 Vi 的增强版**（在 Vi 的基础上增加了正则表达式的查找、多窗口的编辑等功能），使用 Vim 进行程序开发会更加方便。

深入了解 Vi 和 Vim 的区别：在 Vim 命令模式下输入 help vi_diff

### Vim三种工作模式

使用 Vim 编辑文件时，存在 3 种工作模式，分别是**命令模式**、**输入模式**和**编辑模式**，这 3 种工作模式可随意切换。

#### Vim的命令模式

使用 Vim 编辑文件时，默认处于命令模式。此模式下，可使用方向键（上、下、左、右键）或 K、J、H、L 移动光标的位置，还可以对文件内容进行复制、粘贴、替换、删除等操作。

#### Vim的输入模式

在输入模式下，Vim 可以对文件执行写操作。

使 Vim 进行输入模式的方式是在命令模式状态下输入 i、I、a、A、o、O 等插入命令。当编辑文件完成后按 Esc 键即可返回命令模式。

各插入命令的具体功能：

| 快捷键 | 功能描述                                                     |
| ------ | ------------------------------------------------------------ |
| i      | 在**当前光标所在位置**插入随后输入的文本，光标后的文本相应向右移动 |
| I      | 在**光标所在行的行首**插入随后输入的文本，**行首是该行的第一个非空白字符**，相当于光标移动到行首执行 i 命令 |
| o      | 在**光标所在行的下面**插入**新的一行**。光标停在空行的行首，等待输入文本 |
| O      | 在**光标所在行的上面**插入**新的一行**。光标停在空行的行首，等待输入文本 |
| a      | 在**当前光标所在位置之后**插入随后输入的文本                 |
| A      | 在**光标所在行的行尾**插入随后输入的文本，相当于光标移动到行尾再执行a命令 |

#### Vim 的编辑模式

编辑模式用于对文件中的指定内容执行保存、查找或替换等操作。

使 Vim 切换到编辑模式的方法是**在命令模式状态下按 “:” 键**，此时 Vim 窗口的**左下方出现一个 “:” 符号**，这是就可以输入相关指令进行操作了。

**指令执行后 Vim 会自动返回命令模式。如想直接返回命令模式，按 Esc 即可。**

### Vim基本操作

#### Vim 打开文件

刚打开文件时 Vim 处于**命令模式**，此时文件的下方会显示文件的一些信息，包括文件的总行数和字符数，以及当前光标所在的位置等，此时可以使用插入命令进入输入模式对文件进行编辑。

Vim 打开文件的快捷方法：

| Vim 使用的选项         | 说明                                              |
| ---------------------- | ------------------------------------------------- |
| vim filename           | **打开或新建**一个文件，并将光标置于第一行的首部  |
| vim -r filename        | **恢复**上次 vim 打开时崩溃的文件                 |
| vim -R filename        | 把指定的文件**以只读方式**放入 Vim 编辑器中       |
| vim + filename         | 打开文件，并将**光标置于最后一行的首部**          |
| vim +n filename        | 打开文件，并将**光标置于第 n 行的首部**           |
| vi +/pattern filename  | 打幵文件，并将光标置于第一个与 pattern 匹配的位置 |
| vi -c command filename | 在对文件进行编辑前，先执行指定的命令              |

#### 使用 Vim 进行编辑

##### Vim 插入文本

从命令模式进入输入模式进行编辑，使用不同的键，光标所处的位置不同：

| 快捷键 | 功能描述                                                     |
| ------ | ------------------------------------------------------------ |
| i      | 在**当前光标所在位置**插入随后输入的文本，光标后的文本相应向右移动 |
| I      | 在**光标所在行的行首**插入随后输入的文本，**行首是该行的第一个非空白字符**，相当于光标移动到行首执行 i 命令 |
| o      | 在**光标所在行的下面**插入**新的一行**。光标停在空行的行首，等待输入文本 |
| O      | 在**光标所在行的上面**插入**新的一行**。光标停在空行的行首，等待输入文本 |
| a      | 在**当前光标所在位置之后**插入随后输入的文本                 |
| A      | 在**光标所在行的行尾**插入随后输入的文本，相当于光标移动到行尾再执行a命令 |

##### Vim 查找文本

Vim 查找目标文本：

| 快捷键 | 功能描述                         |
| ------ | -------------------------------- |
| /abc   | 从**光标之下**查找字符串 abc     |
| /^abc  | 查找以 abc 为**行首**的行        |
| /abc$  | 查找以 abc 为**行尾**的行        |
| ?abc   | 从**光标之上**查找字符串 abc     |
| n      | 向**同一方向重复**上次的查找指令 |
| N      | 向**相反方向重复**上次的查找指定 |

查找过程中需要注意：查找的字符串是严格区分大小写的。

**如果想忽略大小写，则输入命令 ":set ic"；调整回来输入":set noic"。**

如果在字符串中出现特殊符号，则需要加上转义字符 "\\"。

##### Vim 替换文本

| 快捷键                                     | 功能描述                                                     |
| ------------------------------------------ | ------------------------------------------------------------ |
| r                                          | 替换**光标所在位置**的字符                                   |
| R                                          | 从**光标所在位置开始**替换字符，其输入内容会**覆盖**掉后面等长的文本内容，按“Esc”可以结束 |
| :s/a1/a2/g                                 | 将**当前光标所在行**中的所有 a1 用 a2 替换                   |
| :n1,n2s/a1/a2/g                            | 将**文件中 n1 到 n2 行**中所有 a1 都用 a2 替换               |
| :1,$s/word1/word2/g 或 :%s/word1/word2/g   | 从**第一行到最后一行**寻找 word1 字符串，并将该字符串取代为 word2 |
| :1,$s/word1/word2/gc 或 :%s/word1/word2/gc | 从**第一行到最后一行**寻找 word1 字符串，并将该字符串取代为 word2 ！且在取代前显示提示字符给用户**确认 (confirm) 是否需要取代** |

##### Vim删除文本

| 快捷键  | 功能描述                                                     |
| ------- | ------------------------------------------------------------ |
| x       | 在一行字当中，x 为**向后删除一个字符** (相当于 \[del\] 按键) |
| X       | X 为**向前删除一个字符**(相当于 \[backspace\] 亦即是退格键)  |
| nx      | n 为数字，**连续向后删除 n 个字符**                          |
| dd      | 删除**光标所在行**                                           |
| ndd     | 删除**当前行（包括此行）后 n 行**文本                        |
| d1G     | 删除**光标所在行到第一行**的所有数据                         |
| dG      | 删除**光标所在行一直到文件末尾**的所有内容                   |
| d$      | 删除**游标所在处，到该行的最后一个字符**                     |
| d0      | 删除**游标所在处，到该行的最前面一个字符**                   |
| D       | 删除**光标位置到行尾**的内容                                 |
| :a1,a2d | 函数**从 a1 行到 a2 行**的文本内容                           |

**注意：被删除的内容并没有真正删除，都放在了剪贴板中。将光标移动到指定位置处，按下 "p" 键，就可以将刚才删除的内容又粘贴到此处。**

##### Vim复制和粘贴文本

| 快捷键 | 功能描述                                       |
| ------ | ---------------------------------------------- |
| yy     | 复制**游标所在的那一行**                       |
| nyy    | n 为数字。复制**光标所在的向下 n 行**          |
| y1G    | 复制**游标所在行到第一行**的所有数据           |
| yG     | 复制**游标所在行到最后一行**的所有数据         |
| y0     | 复制**光标所在的那个字符到该行行首**的所有数据 |
| y$     | 复制**光标所在的那个字符到该行行尾**的所有数据 |
| p      | 将剪贴板中的内容粘贴到**光标后**               |
| P      | 将剪贴板中的内容粘贴到**光标前**               |

##### Vim其他常用快捷键

| 快捷键   | 功能描述                                         |
| -------- | ------------------------------------------------ |
| J        | 将光标所在行与下一行的数据**结合成同一行**       |
| c        | 重复删除多个数据，例如向下删除 10 行，\[ 10cj \] |
| u        | **复原前一个动作**                               |
| [Ctrl]+r | **重做上一个动作**                               |
| \.       | **重复前一个动作**                               |

#### Vim 保存退出文本

Vim 的保存和退出是在编辑模式中进行的。

| 命令        | 功能描述                                           |
| ----------- | -------------------------------------------------- |
| :wq         | 保存并退出 Vim 编辑器                              |
| :wq!        | 保存并强制退出 Vim 编辑器                          |
| :q          | 不保存就退出 Vim 编辑器                            |
| :q!         | 不保存，且强制退出 Vim 编辑器                      |
| :w          | 保存但是不退出 Vim 编辑器                          |
| :w!         | 强制保存文本                                       |
| :w filename | 另存到 filename 文件                               |
| x！         | 保存文本，并退出 Vim 编辑器，更通用的一个 vim 命令 |
| ZZ          | 直接退出 Vim 编辑器，效果等同于(保存并退出)        |
| ZQ          | 不保存，强制退出。效果等同于 :q!                   |
| :! command  | 暂时离开 vi 到指令行模式下执行 command 的显示结果  |

### Vim移动光标快捷键

**所有的快捷键都在命令模式（默认状态）下直接使用。**

#### Vim快捷方向键

#### Vim光标以单词为单位移动

| 快捷键   | 功能描述                                |
| -------- | --------------------------------------- |
| w 或 W   | 光标移动至**下一个单词的单词首**        |
| b 或 B   | 光标移动至**上一个单词的单词首**        |
| e 或 E   | 光标移动至**下一个单词的单词尾**        |
| nw 或 nW | n 为数字，表示**光标向右移动 n 个单词** |
| nb 或 nB | n 为数字，表示**光标向左移动 n 个单词** |

#### Vim光标移动至行首或行尾

| 快捷键 | 功能描述                                     |
| ------ | -------------------------------------------- |
| 0 或 ^ | 光标移动至**当前行的行首**                   |
| $      | 光标移动至**当前行的行尾**                   |
| n$     | 光标移动至**当前行只有 n 行的行尾**，n为数字 |

#### Vim光标移动至指定字符

| 快捷键 | 功能描述                                      |
| ------ | --------------------------------------------- |
| fx     | 光标移动至**当前行中下一个 x 字符处**         |
| Fx     | 光标移动至**当前行中上一个 x 字符处**（反向） |

#### Vim光标移动到指定行

| 快捷键 | 功能描述                                                     |
| ------ | ------------------------------------------------------------ |
| gg     | 光标移动到**文件开头**                                       |
| G      | 光标移动至**文件末尾**                                       |
| nG     | 光标**移动到第 n 行**，n 为数字                              |
| :n     | 编辑模式下使用的快捷键，可以将光标**快速定义到指定行的行首** |

#### Vim光标移动到匹配的括号处

Vim 里面提供了一个非常方便地査找匹配括号的命令，这就是 "%"。

将光标先定位在 "{" 处，然后再使用 "％" 命令，使之定位在 "}" 处。

### Vim撤销和恢复撤销快捷键

Vim 撤销和恢复撤销快捷键：

| 快捷键    | 功能                                                         |
| --------- | ------------------------------------------------------------ |
| u（小写） | undo 的第 1 个字母，功能是**撤销最近一次对文本做的修改操作** |
| Ctrl+R    | Redo 的第 1 个字母，功能是**恢复最近一次所做的撤销操作**     |
| U（大写） | **第一次会撤销**对一行文本（光标所在行）做过的全部操作，**第二次使用该命令会恢复**对该行文本做过的所有操作 |

注意：以上这 3 种命令都必须在 **Vim 编辑器处于命令模式时才能使用**。

### Vim可视化模式

在 Vim 中，如果想选中目标文本，就需要调整 Vim 进入可视化模式。

进入Vim可视化模式的方式：

| 命令             | 功能                                                         |
| ---------------- | ------------------------------------------------------------ |
| v（小写）        | 又称**字符可视化模式**，此模式下目标文本的选择是**以字符为单位**的，也就是说，该模式下要一个字符一个字符的选中要操作的文本 |
| V（大写）        | 又称**行可视化模式**，此模式化目标文本的选择是**以行为单位**的，也就是说，该模式化可以一行一行的选中要操作的文本 |
| Ctrl+v（组合键） | 又称**块可视化模式**，该模式下可以**选中文本中的一个矩形区域作为目标文本**，以按下 Ctrl+v 位置作为矩形的一角，光标移动的终点位置作为它的对角。 |

Vim 成功进入**字符可视化模式**的标志是窗口底部出现 **--VISUAL--** 标志。

进入**行可视化模式**的标志是显示 **--VISUAL LINE--**；进入**块可视化模式**的标志是显示 **--VISUAL BLOCK--**。

注意：当选中文本并做完相应操作，Vim 会自动从可视化模式转换为命令模式。

可视化模式支持使用的命令：

| 命令      | 功能                                                         |
| --------- | ------------------------------------------------------------ |
| d         | 删除**选中的部分文本**                                       |
| D         | 删除**选中部分所在的行**，和 d 不同之处在于，即使选中文本中有些字符所在的行没有都选中，删除时也会一并删除 |
| y         | 将**选中部分**复制到剪贴板中                                 |
| p（小写） | 将剪贴板中的内容粘贴到光标之后                               |
| P（大写） | 将剪贴板中的内容粘贴到光标之前                               |
| u（小写） | 将选中部分中的**大写字符全部改为小写字符**                   |
| U（大写） | 将选中部分中的**小写字符全部改为大写字符**                   |
| >         | 将选中部分**右移（缩进）一个 tab 键**规定的长度              |
| <         | 将选中部分**左移一个 tab 键**规定的长度                      |

### Vim批量注释和自定义注释快捷键

连续行的注释其实可以用**替换命令**来完成。换句话说，在指定范围行加"#"注释，可以使用 ":起始行，终止行 s/^/#/g"。"^"意为行首，"g"表示执行替换时不询问确认。如果希望每行交互询问是否执行，则可将 "g" 改为 "c"。

取消连续行注释，则可以使用 ":起始行，终止行s/^#//g"。

使用语言不同，注释符号或想替换的内容不同，都可以采用此方法，灵活运用即可。

**定义快捷键：:map 快捷键 执行命令**

取消此快捷键定义，输入 **":unmap^P"** 即可。

**将快捷键对应的命令保存在 .vimrc 文件中，即可在每次使用 Vim 时自动调用，非常方便。**

