# Linux文件和目录管理

[TOC]

在 Linux 系统中，一切都是文件。

**FHS（Filesystem Hierarchy Standard）**，文件系统层次化标准，该标准规定了 Linux 系统中**所有一级目录**以及**部分二级目录**（/usr 和 /var）的用途。发布此标准的主要目的就是为了让用户清楚地了解每个目录应该存放什么类型的文件。

**Linux /usr目录**：全称为 Unix Software Resource，此目录用于存储系统软件资源。FHS 建议所有开发者，应把软件产品的数据合理的放置在 /usr 目录下的各子目录中，而不是为他们的产品创建单独的目录。

**Linux /var 目录**：用于存储动态数据，例如缓存、日志文件、软件运行过程中产生的文件等。

### Linux命令基本格式

#：命令提示符，Linux 用这个符号标识登录的用户权限等级。如果是**超级用户**，提示符就是 #；如果是**普通用户**，提示符就是 $。

Linux 系统是纯字符界面，用户登录后，要有一个初始登录的位置，这个初始登录位置就称为用户的家：

- 超级用户的家目录：/root。
- 普通用户的家目录：/home/用户名。

Linux 命令的基本格式：命令 \[选项\] \[参数\]

命令格式中的 [] 代表可选项，也就是有些命令可以不写选项或参数，也能执行。

参数的作用：**参数是命令的操作对象**，一般文件、目录、用户和进程等可以作为参数被命令操作。

总结一下：命令的选项用于调整命令功能，而命令的参数是这个命令的操作对象。

Linux 命令按照来源方式，可分为两种，分别是 Shell **内置命令**和**外部命令**。所谓 Shell 内置命令，就是 Shell 自带的命令，这些命令是**没有执行文件**的；而外部命令就是由程序员单独开发的，所以会有命令的执行文件。Linux 中的绝大多数命令是外部命令，而 **cd 命令是一个典型的 Shell 内置命令**，所以 cd 命令没有执行文件所在路径。

### cd命令：切换目录

cd 命令，是 Change Directory 的缩写，用来切换工作目录。

特殊符号：-，作用：代表上次所在目录。

### pwd命令：显示当前路径

pwd 命令，是 Print Working Directory （打印工作目录）的缩写，功能是显示用户当前所处的工作目录。

### ls命令：查看目录下文件

ls 命令，list 的缩写，是最常见的目录操作命令，其主要功能是显示当前目录下的内容。

ls 命令常用的选项以及各自的功能：

| 选项                                              | 功能                                                         |
| ------------------------------------------------- | ------------------------------------------------------------ |
| -a                                                | 显示全部的文件，包括隐藏文件（开头为 . 的文件）也一起罗列出来，这是最常用的选项之一。 |
| -A                                                | 显示全部的文件，连同隐藏文件，**但不包括 . 与 .. 这两个目录**。 |
| -d                                                | 仅列出目录本身，而不是列出目录内的文件数据。                 |
| -f                                                | ls 默认会以文件名排序，使用 -f 选项会直接列出结果，而不进行排序。 |
| -F                                                | 在文件或目录名后加上文件类型的指示符号，例如，* 代表可运行文件，/ 代表目录，= 代表 socket 文件，\| 代表 FIFO 文件。 |
| -h                                                | 以人们易读的方式显示文件或目录大小，如 1KB、234MB、2GB 等。  |
| -i                                                | 显示 inode 节点信息。                                        |
| -l                                                | 使用长格式列出文件和目录信息。                               |
| -n                                                | 以 UID 和 GID 分别代替文件用户名和群组名显示出来。           |
| -r                                                | 将排序结果反向输出，比如，若原本文件名由小到大，反向则为由大到小。 |
| -R                                                | 连同子目录内容一起列出来，等於将该目录下的所有文件都显示出来。 |
| -S                                                | 以文件容量大小排序，而不是以文件名排序。                     |
| -t                                                | 以时间排序，而不是以文件名排序。                             |
| --color=never<br/>--color=always<br/>--color=auto | never 表示不依据文件特性给予颜色显示。<br/>always 表示显示颜色，ls 默认采用这种方式。<br/>auto 表示让系统自行依据配置来判断是否给予颜色。 |
| --full-time                                       | 以完整时间模式 （包含年、月、日、时、分）输出                |
| --time={atime,ctime}                              | 输出 access 时间或改变权限属性时间（ctime），而不是内容变更时间。 |

 ls 命令使用 -l 选项，显示出了文件的详细信息，此选项显示的这 7 列的含义分别是：

1. 第一列：规定了不同的用户对文件所拥有的权限。
2. 第二列：引用计数，文件的引用计数代表该文件的硬链接个数，而目录的引用计数代表该目录有多少个一级子目录。
3. 第三列：所有者，也就是这个文件属于哪个用户。默认所有者是文件的建立用户。
4. 第四列：所属组，默认所属组是文件建立用户的有效组，一般情况下就是建立用户的所在组。
5. 第五列：大小，默认单位是字节。
6. 第六列：文件修改时间，文件状态修改时间或文件数据修改时间都会更改这个时间，注意这个时间不是文件的创建时间。
7. 第七列：文件名或目录名。

### mkdir命令：创建目录（文件夹）

mkdir 命令，是 make directories 的缩写，用于创建新目录，此命令所有用户都可以使用。

**mkdir 命令的基本格式为：mkdir \[-mp\] 目录名**

-m 选项用于手动配置所创建目录的权限，而不再使用默认权限。

**-p 选项递归创建所有目录**，以创建 /home/test/demo 为例，在默认情况下，你需要一层一层的创建各个目录，而使用 -p 选项，则系统会自动帮你创建 /home、/home/test 以及 /home/test/demo。

### rmdir命令：删除空目录

rmdir（remove empty directories 的缩写）命令用于删除空目录。

-p 选项用于递归删除空目录。

### touch命令：创建文件及修改文件时间戳

touch 命令不光可以用来**创建文件**（当指定操作文件不存在时，该命令会在当前位置建立一个空文件），此命令更重要的功能是**修改文件的时间参数**（但当文件存在时，会修改此文件的时间参数）。

Linux 系统中，每个文件主要拥有 3 个时间参数（通过 stat 命令进行查看），分别是文件的访问时间、数据修改时间以及状态修改时间：

- **访问时间（Access Time，简称 atime）**：只要文件的内容被读取，访问时间就会更新。例如，使用 cat 命令可以查看文件的内容，此时文件的访问时间就会发生改变。
- **数据修改时间（Modify Time，简称 mtime）**：当文件的内容数据发生改变，此文件的数据修改时间就会跟着相应改变。
- **状态修改时间（Change Time，简称 ctime）**：当文件的状态发生变化，就会相应改变这个时间。比如说，如果文件的权限或者属性发生改变，此时间就会相应改变。

选项：

- -a：只修改文件的访问时间。
- -c：仅修改文件的时间参数（3 个时间参数都改变），如果文件不存在，则不建立新文件。
- -d：后面可以跟欲修订的日期，而不用当前的日期，即把文件的 atime 和 mtime 时间改为指定的时间。
- -m：只修改文件的数据修改时间。
- -t：命令后面可以跟欲修订的时间，而不用目前的时间，时间书写格式为 YYMMDDhhmm。

### ln命令：建立链接（硬链接和软链接）文件

ext4 文件系统会把分区主要分为两大部分（暂时不提超级块）：小部分用于保存文件的 **inode (i 节点）信息**；剩余的大部分用于保存 **block 信息**。

inode 的**默认大小为 128 Byte**，用来记录文件的权限（r、w、x）、文件的所有者和属组、文件的大小、文件的状态改变时间（ctime）、文件的最近一次读取时间（atime）、文件的最近一次修改时间（mtime）、文件的数据真正保存的 block 编号。每个文件需要占用一个 inode。大家如果仔细查看，就会发现 inode 中是不记录文件名的，那是因为**文件名记录在文件所在目录的 block 中**。

block 的大小可以是 1KB、2KB、4KB，**默认为 4KB**。block 用于实际的数据存储，如果一个 block 放不下数据，则可以占用多个 block。

**重要信息：**

- 每个文件都独自占用一个 inode，文件内容由 inode 的记录来指向。
- 如果想要读取文件内容，就必须**借助目录中记录的文件名找到该文件的 inode**，才能成功找到文件内容所在的 block 块。

ln 命令用于给文件创建链接，根据 Linux 系统存储文件的特点，链接的方式分为以下 2 种：

- **软链接**：类似于 Windows 系统中给文件创建**快捷方式**，即产生一个特殊的文件，该文件用来指向另一个文件，此链接方式**同样适用于目录**。
- **硬链接**：文件的基本信息都存储在 inode 中，而硬链接指的就是**给一个文件的 inode 分配多个文件名**，通过任何一个文件名，都可以找到此文件的 inode，从而读取该文件的数据信息。

**ln 命令的基本格式：ln \[选项\] 源文件 目标文件**

选项：

- -s：**建立软链接文件**。如果不加 "-s" 选项，则建立硬链接文件。
- -f：**强制**。如果目标文件已经存在，则删除目标文件后再建立链接文件。

### cp命令：复制文件和目录

cp 命令，主要用来复制文件和目录，同时借助某些选项，还可以实现复制整个目录，以及比对两文件的新旧而予以升级等功能。

**cp 命令的基本格式：cp \[选项\] 源文件 目标文件**

选项：

- -a：相当于 -d、-p、-r 选项的集合。
- -d：如果源文件为软链接（对硬链接无效），则复制出的目标文件也为软链接。
- -i：询问，如果目标文件已经存在，则会询问是否覆盖。
- -l：把目标文件建立为源文件的硬链接文件，而不是复制源文件。
- -s：把目标文件建立为源文件的软链接文件，而不是复制源文件。
- -p：复制后目标文件保留源文件的属性（包括所有者、所属组、权限和时间）。
- **-r：递归复制，用于复制目录。**
- -u：若目标文件比源文件有差异，则使用该选项可以更新目标文件，此选项可用于对文件的升级和备用。

### rm命令：删除文件或目录

rm 是强大的删除命令，它可以永久性地删除文件系统中指定的文件或目录。在使用 rm 命令删除文件或目录时，系统不会产生任何提示信息。

选项：

- **-f：强制删除（force）**，使用 -f，系统将不再询问，而是直接删除目标文件或目录。
- -i：在删除文件或目录之前，系统会给出提示信息，使用 -i 可以有效防止不小心删除有用的文件或目录。
- **-r：递归删除**，主要用于删除目录，可删除指定目录及包含的所有内容，包括所有的子目录和文件。

### mv命令：移动文件或改名

mv 命令（move 的缩写），既可以在不同的目录之间移动文件或目录，也可以对文件和目录进行重命名。

选项：

- -f：强制覆盖，如果目标文件已经存在，则不询问，直接强制覆盖。
- -i：交互移动，如果目标文件已经存在，则询问用户是否覆盖（默认选项）。
- -n：如果目标文件已经存在，则不会覆盖移动，而且不询问用户。
- -v：显示文件或目录的移动过程。
- -u：若目标文件已经存在，但两者相比，源文件更新，则会对目标文件进行升级。

同 rm 命令类似，mv 命令也是一个具有破坏性的命令，如果使用不当，很可能给系统带来灾难性的后果。

改名：如果源文件和目标文件在同一目录中，那就是改名。

### Linux环境变量及作用

在 Linux 系统中，**环境变量是用来定义系统运行环境的一些参数**，比如每个用户不同的家目录（HOME）、邮件存放位置（MAIL）等。

Linux 系统中环境变量的名称**一般都是大写**的，这是一种约定俗成的规范。

可以使用 **env 命令**来查看到 Linux 系统中所有的环境变量。

#### Linux系统中重要的10个环境变量

| 环境变量名称 | 作用                                   |
| ------------ | -------------------------------------- |
| HOME         | 用户的主目录（也称家目录）             |
| SHELL        | 用户使用的 Shell 解释器名称            |
| PATH         | 定义命令行解释器搜索用户执行命令的路径 |
| EDITOR       | 用户默认的文本解释器                   |
| RANDOM       | 生成一个随机数字                       |
| LANG         | 系统语言、语系名称                     |
| HISTSIZE     | 输出的历史命令记录条数                 |
| HISTFILESIZE | 保存的历史命令记录条数                 |
| PS1          | Bash解释器的提示符                     |
| MAIL         | 邮件保存路径                           |

可以自行创建环境变量来满足工作需求，如果工作需要，可以使用 export 命令将其提升为全局环境变量。

