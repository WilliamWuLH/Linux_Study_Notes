# Linux文本处理

[TOC]

### cat命令：连接文件并打印输出到标准输出设备

cat 命令可以用来**显示文本文件的内容**，也可以把几个文件内容附加到另一个文件中，即**连接合并文件**。

cat 是 **concatenate（连接、连续）**的简写。

**基本格式：**

用于显示文件的内容：**cat [选项] 文件名**

用于连接合并文件：**cat 文件1 文件2 > 文件3**

cat 命令常用选项及含义：

| 选项 | 含义                                                   |
| ---- | ------------------------------------------------------ |
| -A   | 相当于 -vET 选项的整合，用于**列出所有隐藏符号**       |
| -E   | 列出每行结尾的回车符 $                                 |
| -n   | 对输出的**所有行进行编号**                             |
| -b   | 同 -n 不同，此选项表示**只对非空行进行编号**           |
| -T   | 把 Tab 键 ^I 显示出来                                  |
| -V   | 列出特殊字符                                           |
| -s   | 当遇到有连续 2 行以上的空白行时，就替换为 1 行的空白行 |

### more命令：分屏显示文件内容

more 命令可以分页显示文本文件的内容，使用者可以逐页阅读文件中内容。

**基本格式：more [选项] 文件名**

more 命令选项及含义：

| 选项 | 含义                                                     |
| ---- | -------------------------------------------------------- |
| -f   | 计算行数时，以实际的行数，而不是自动换行过后的行数       |
| -p   | 不以卷动的方式显示每一页，而是**先清除屏幕后再显示内容** |
| -c   | 跟 -p 选项相似，不同的是**先显示内容再清除其他旧资料**   |
| -s   | 当遇到有连续两行以上的空白行时，就替换为一行的空白行     |
| -u   | 不显示下引号（根据环境变量 TERM 指定的终端而有所不同）   |
| +n   | 从第 n 行开始显示文件内容，n 代表数字                    |
| -n   | 一次显示的行数，n 代表数字                               |

more 命令交互指令及功能：

| 交互指令            | 功能                       |
| ------------------- | -------------------------- |
| h 或 ？             | 显示 more 命令交互命令帮助 |
| q 或 Q              | 退出 more                  |
| v                   | 在当前行启动一个编辑器     |
| :f                  | 显示当前文件的文件名和行号 |
| !<命令> 或 :!<命令> | 在子Shell中执行指定命令    |
| 回车键              | 向下移动一行               |
| 空格键              | 向下移动一页               |
| Ctrl+l              | 刷新屏幕                   |
| =                   | 显示当前行的行号           |
| '                   | 转到上一次搜索开始的地方   |
| Ctrf+f              | 向下滚动一页               |
| .                   | 重复上次输入的命令         |
| / 字符串            | 搜索指定的字符串           |
| d                   | 向下移动半页               |
| b                   | 向上移动一页               |

### head命令：显示文件开头的内容

**基本格式：head [选项] 文件名**

head 命令常用选项及含义：

| 选项 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| -n K | 这里的 K 表示**行数**，该选项用来**显示文件前 K 行的内容**<br>如果使用 **"-K"** 作为参数，则表示除了文件最后 K 行外，显示剩余的全部内容 |
| -c K | 这里的 K 表示**字节数**，该选项用来**显示文件前 K 个字节的内容**<br>如果使用 **"-K"**，则表示除了文件最后 K 字节的内容，显示剩余全部内容。 |
| -v   | 显示文件名                                                   |

**注意：如不设置显示的具体行数，则默认显示 10 行的文本数据。**

### less命令：查看文件内容

使用 more 命令浏览文件内容时，只能不断向后翻看，而使用 less 命令浏览，既可以向后翻看，也可以向前翻看。

**基本格式：less [选项] 文件名**

less 命令选项及含义：

| 选项            | 选项含义                                             |
| --------------- | ---------------------------------------------------- |
| -N              | 显示每行的行号                                       |
| -S              | 行过长时将超出部分舍弃                               |
| -e              | 当文件显示结束后，自动离开                           |
| -g              | 只标志最后搜索到的关键词                             |
| -Q              | 不使用警告音                                         |
| -i              | 忽略搜索时的大小写                                   |
| -m              | 显示类似 more 命令的百分比                           |
| -f              | 强迫打开特殊文件，比如外围设备代号、目录和二进制文件 |
| -s              | 显示连续空行为一行                                   |
| -b <缓冲区大小> | 设置缓冲区的大小                                     |
| -o <文件名>     | 将 less 输出的内容保存到指定文件中                   |
| -x <数字>       | 将【Tab】键显示为规定的数字空格                      |

less 交互指令及功能：

| 交互指令   | 功能                                     |
| ---------- | ---------------------------------------- |
| /字符串    | **向下搜索**“字符串”的功能               |
| ?字符串    | **向上搜索**“字符串”的功能               |
| n          | **重复**前一个搜索（与 / 成 ? 有关）     |
| N          | **反向重复**前一个搜索（与 / 或 ? 有关） |
| b          | **向上**移动一**页**                     |
| d          | **向下**移动**半页**                     |
| h 或 H     | 显示帮助界面                             |
| q 或 Q     | **退出** less 命令                       |
| y          | **向上**移动一**行**                     |
| 空格键     | **向下**移动一**页**                     |
| 回车键     | **向下**移动一**行**                     |
| 【PgDn】键 | **向下**移动一**页**                     |
| 【PgUp】键 | **向上**移动一**页**                     |
| Ctrl+f     | **向下**移动一**页**                     |
| Ctrl+b     | **向上**移动一**页**                     |
| Ctrl+d     | **向下**移动一**页**                     |
| Ctrl+u     | **向上**移动**半页**                     |
| j          | **向下**移动一**行**                     |
| k          | **向上**移动一**行**                     |
| G          | 移动至**最后一行**                       |
| g          | 移动到**第一行**                         |
| ZZ         | **退出** less 命令                       |
| v          | 使用配置的编辑器**编辑**当前文件         |
| [          | 移动到本文档的**上一个节点**             |
| ]          | 移动到本文档的**下一个节点**             |
| p          | 移动到同级的**上一个节点**               |
| u          | **向上**移动**半页**                     |

### tail命令：显示文件结尾的内容

tail 命令和 head 命令正好相反，它用来查看文件末尾的数据。

**基本格式：tail [选项] 文件名**

tail 命令选项及含义：

| 选项 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| -n K | 这里的 K 指的是**行数**，该选项表示输出**最后 K 行**<br>在此基础上，如果使用 -n +K，则表示从文件的第 K 行开始输出 |
| -c K | 这里的 K 指的是**字节数**，该选项表示输出文件**最后 K 个字节的内容**<br/>在此基础上，使用 -c +K 则表示从文件第 K 个字节开始输出 |
| -f   | 输出文件变化后新增加的数据                                   |

**tail 命令有一种比较有趣的用法，可以使用 "-f" 选项来监听文件的新増内容。**

### grep命令：查找文件内容

grep 命令的由来可以追溯到 UNIX 诞生的早期，在 UNIX 系统中，搜索的模式（patterns）被称为**正则表达式（regular expressions）**，为了要彻底搜索一个文件，有的用户在要搜索的字符串前加上前缀 global（全面的），一旦找到相匹配的内容，用户就像将其输出（print）到屏幕上，而将这一系列的操作整合到一起就是 **global regular expressions print**，而这也就是 grep 命令的全称。

grep命令能够在一个或多个文件中，搜索某一特定的字符模式（也就是正则表达式），此模式可以是单一的字符、字符串、单词或句子。

**正则表达式的通配符：**

| 通配符 | 功能                                                         |
| ------ | ------------------------------------------------------------ |
| ^      | 匹配输入字符串的开始位置，除非在方括号表达式中使用，当该符号在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合。要匹配 ^ 字符本身，请使用 \\^ |
| $      | 匹配输入字符串的结尾位置。要匹配 ​\$ 字符本身，请使用 \\$     |
| ( )    | 标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 \\( 和 \\) |
| .      | 匹配除换行符 \n 之外的任何单字符。要匹配 . ，请使用 \\.      |
| *      | 匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 \\*      |
| +      | 匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 \\+      |
| ?      | 匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 \\? |
| .*     | 代表任意字符串                                               |
| \      | 将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如，'n' 匹配字符 'n'。'\\n' 匹配换行符。序列 '\\\\' 匹配 "\\"，而 '\\(' 则匹配 "(" |
| []     | 匹配一个指定范围内的字符，如：'[Gg]rep' 匹配 Grep 和 grep    |
| [^]    | 匹配一个不在指定范围内的字符，如：'\[^A-FH-Z\]rep' 匹配不包含 A-F 和 H-Z 的一个字母开头，紧跟 rep 的行 |
| \w     | 匹配字母、数字、下划线。等价于 [A-Za-z0-9_]                  |
| {n}    | n 是一个非负整数。匹配确定的 n 次。例如，'o{2}' 不能匹配 "Bob" 中的 'o'，但是能匹配 "food" 中的两个 o |
| {n,}   | n 是一个非负整数。至少匹配 n 次。例如，'o{2,}' 不能匹配 "Bob" 中的 'o'，但能匹配 "foooood" 中的所有 o。'o{1,}' 等价于 'o+'。'o{0,}' 则等价于 'o*' |
| {n,m}  | m 和 n 均为非负整数，其中n <= m。最少匹配 n 次且最多匹配 m 次。例如，"o{1,3}" 将匹配 "fooooood" 中的前三个 o。'o{0,1}' 等价于 'o?'。请注意在逗号和两个数之间不能有空格 |

grep 命令是用来在**每一个文件**或**特定输出上**搜索特定的模式，当使用 grep 时，包含指定字符模式的每一行内容，都会被打印（显示）到屏幕上，但是使用 grep 命令并不改变文件中的内容。

**基本格式：grep [选项] 模式 文件名**

grep 命令常用选项及含义：

| 选项 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| -c   | 仅列出文件中包含模式的行数                                   |
| -E   | 将范本样式为延伸的普通表示法来使用，意味着使用能使用扩展正则表达式 |
| -i   | 忽略模式中的字母大小写                                       |
| -l   | 列出带有匹配行的文件名                                       |
| -n   | 在每一行的最前面列出行号                                     |
| -v   | 列出没有匹配模式的行                                         |
| -w   | 把表达式当做一个完整的单字符来搜寻，忽略那些部分匹配的行     |

注意：如果是搜索多个文件，grep 命令的搜索结果**只显示文件中发现匹配模式的文件名**；而如果搜索单个文件，grep 命令的结果将**显示每一个包含匹配模式的行**。

### sed命令

sed 命令采用的是**流编辑模式**，最明显的特点是，在 sed 处理数据之前，**需要预先提供一组规则**，sed 会按照此规则来编辑数据。

sed 会根据**脚本命令**来处理文本文件中的数据，这些命令要么从命令行中输入，要么存储在一个文本文件中，此命令执行数据的顺序如下：

1. 每次仅读取一行内容。
2. 根据提供的规则命令匹配并修改数据。注意：sed 默认不会直接修改源文件数据，而是会**将数据复制到缓冲区**中，修改也仅限于缓冲区中的数据。
3. 将执行结果输出。

当一行数据匹配完成后，它会继续读取下一行数据，并**重复这个过程**，直到将文件中所有数据处理完毕。

**基本格式：sed [选项] [脚本命令] 文件名**

sed 命令常用选项及含义：

| 选项            | 含义                                                         |
| --------------- | ------------------------------------------------------------ |
| -e 脚本命令     | 该选项会将其后跟的脚本命令添加到已有的命令中                 |
| -f 脚本命令文件 | 该选项会将其后文件中的脚本命令添加到已有的命令中             |
| -n              | 默认情况下，sed 会在所有的脚本指定执行完毕后，会自动输出处理后的内容，而该选项会屏蔽启动输出，需使用 print 命令来完成输出 |
| -i              | **此选项会直接修改源文件，要慎用**                           |

成功使用 sed 命令的关键在于**掌握各式各样的脚本命令及格式**，它能帮你定制编辑文件的规则。

#### sed脚本命令

##### sed s 替换脚本命令

**基本格式：[address]s/pattern/replacement/flags**

其中，address 表示指定要操作的具体行，pattern 指的是需要替换的内容，replacement 指的是要替换的新内容。

sed s命令flags标记及功能：

| flags 标记 | 功能                                                         |
| ---------- | ------------------------------------------------------------ |
| n          | 1~512 之间的数字，表示指定要替换的字符串**出现第几次时才进行替换**，例如，一行中有 3 个 A，但用户只想替换第二个 A，这是就用到这个标记 |
| g          | 对数据中**所有匹配到的内容进行替换**，如果没有 g，则只会在第一次匹配成功时做替换操作。例如，一行数据中有 3 个 A，则只会替换第一个 A |
| p          | **会打印与替换命令中指定的模式匹配的行**。此标记通常与 -n 选项一起使用 |
| w file     | 将缓冲区中的内容**写到指定的 file 文件**中                   |
| &          | 用正则表达式匹配的内容进行替换                               |
| \n         | 匹配第 n 个子串，该子串之前在 pattern 中用 \(\) 指定         |
| \          | 转义（转义替换部分包含：&、\ 等）                            |

##### sed d 替换脚本命令

**基本格式：[address]d**

如果需要删除文本中的特定行，可以用 d 脚本命令，它会删除指定行中的所有内容。但使用该命令时要特别小心，如果你忘记指定具体行的话，文件中的所有内容都会被删除。

##### sed a 和 i 脚本命令

a 命令表示在指定行的后面附加一行，i 命令表示在指定行的前面插入一行。

**基本格式：[address]a（或 i）\新文本内容**

如果想将一个**多行数据**添加到数据流中，只需对要插入或附加的文本中的**每一行末尾（除最后一行）添加反斜线**即可。

##### sed c 替换脚本命令

c 命令表示将指定行中的所有内容，替换成该选项后面的字符串。

**基本格式：[address]c\用于替换的新文本**

##### sed y 转换脚本命令

y 转换命令是唯一可以处理单个字符的 sed 脚本命令。

**基本格式：[address]y/inchars/outchars/**

转换命令会对 inchars 和 outchars 值进行一对一的映射，即 inchars 中的第一个字符会被转换为 outchars 中的第一个字符，第二个字符会被转换成 outchars 中的第二个字符...这个映射过程会一直持续到处理完指定字符。**如果 inchars 和 outchars 的长度不同，则 sed 会产生一条错误消息。**

转换命令是一个**全局命令**，也就是说，它在文本行中找到的所有指定字符自动进行转换，而不会考虑它们出现的位置。

##### sed p 打印脚本命令

p 命令表示搜索符合条件的行，并输出该行的内容。

**基本格式：[address]p**

p 命令常见的用法是打印包含匹配文本模式的行。

用 **-n 选项和 p 命令配合使用**，我们可以禁止输出其他行，只打印包含匹配文本模式的行。

##### sed w 脚本命令

w 命令用来将文本中指定行的内容写入文件中。

**基本格式：[address]w filename**

这里的 filename 表示文件名，可以使用相对路径或绝对路径，但不管是哪种，运行 sed 命令的用户都必须有文件的写权限。

##### sed r 脚本命令

r 命令用于将一个独立文件的数据插入到当前数据流的指定位置。

**基本格式：[address]r filename**

sed 命令会将 filename 文件中的内容插入到 address 指定行的后面。

如果你想将指定文件中的数据插入到数据流的末尾，可以使用 $ 地址符。

##### sed q 退出脚本命令

q 命令的作用是使 sed 命令在第一次匹配任务结束后，退出 sed 程序，不再进行对后续数据的处理。

#### sed 脚本命令的寻址方式

对各个脚本命令来说，**address 用来表明该脚本命令作用到文本中的具体行。**

默认情况下，sed 命令会作用于文本数据的所有行。如果只想将命令作用于特定行或某些行，则必须写明 address 部分，表示的方法有以下 2 种：

1. 以数字形式指定行区间。
2. 用文本模式指定具体行区间。

以上两种形式都可以使用如下这 2 种格式：

1. [address]脚本命令
2. address {
       多个脚本命令
   }

##### 以数字形式指定行区间

当使用数字方式的行寻址时，可以用行在文本流中的行位置来引用。sed 会将文本流中的第一行编号为 1，然后继续按顺序为接下来的行分配行号。

在脚本命令中，指定的地址可以是**单个行号**，或是用**起始行号、逗号以及结尾行号**指定的一定区间范围内的行。

##### 用文本模式指定行区间

sed 允许指定文本模式来过滤出命令要作用的行。

**格式：/pattern/command**

注意：必须用**正斜线**将要指定的 pattern 封起来，sed 会将该命令作用到包含指定文本模式的行上。

sed 允许在文本模式使用**正则表达式**指明作用的具体行。

### awk命令

此命令的设计者有 3 位，他们的姓分别是 Aho、Weingberger 和 Kernighan，awk 就取自这 3 为大师姓的首字母。

和 sed 命令类似，**awk 命令也是逐行扫描文件（从第 1 行到最后一行）**，寻找含有目标文本的行，如果匹配成功，则会在该行上执行用户想要的操作；反之，则不对行做任何处理。

**基本格式：awk [选项] '脚本命令' 文件名**

awk 命令选项以及含义：

| 选项       | 含义                                                         |
| ---------- | ------------------------------------------------------------ |
| -F fs      | 指定以 fs 作为输入行的分隔符，awk 命令默认分隔符为空格或制表符 |
| -f file    | 从脚本文件中读取 awk 脚本指令，以取代直接在命令行中输入指令  |
| -v var=val | 在执行处理过程之前，设置一个变量 var，并给其设备初始值为 val |

awk 的强大之处在于**脚本命令**，它由 2 部分组成，分别为匹配规则和执行命令：**'匹配规则{执行命令}'**

这里的**匹配规则**，和 sed 命令中的 address 部分作用相同，用来**指定脚本命令可以作用到文本内容中的具体行**，可以使用字符串（比如 /demo/，表示查看含有 demo 字符串的行）或者正则表达式指定。

另外需要注意的是，整个脚本命令是**用单引号（''）括起**，而其中的**执行命令部分需要用大括号（{}）括起来**。

在 awk 程序执行时，如果没有指定执行命令，则**默认会把匹配的行输出**；如果不指定匹配规则，则**默认匹配文本中所有的行**。

#### awk 使用数据字段变量

awk 的主要特性之一是其**处理文本文件中数据**的能力，它会自动给一行中的每个数据元素分配一个变量。

默认情况下，awk 会将如下变量分配给它在文本行中发现的数据字段：

- $0 代表整个文本行
- $1 代表文本行中的第 1 个数据字段
- $2 代表文本行中的第 2 个数据字段
- $n 代表文本行中的第 n 个数据字段

在 awk 中，**默认的字段分隔符是任意的空白字符**（例如空格或制表符）。

在文本行中，每个数据字段都是通过字段分隔符划分的。awk 在读取一行文本时，会用预定义的字段分隔符划分每个数据字段。

如果你要读取采用了其他字段分隔符的文件，可以用 -F 选项手动指定。

#### awk 脚本命令使用多个命令

awk 允许将多条命令组合成一个正常的程序。要在命令行上的程序脚本中使用多条命令，只要**在命令之间放个分号**即可。

在你用了表示起始的单引号后，bash shell 会**使用 > 来提示输入更多数据**，我们可以每次在每行加一条命令，直到输入了结尾的单引号。

#### awk从文件中读取程序

跟 sed 一样，awk 允许将脚本命令存储到文件中，然后再在命令行中引用。

注意：在程序文件中，也可以指定多条命令，只要一条命令放一行即可，之间不需要用分号。

#### awk BEGIN关键字

awk 中还可以指定脚本命令的运行时机。默认情况下，awk 会从输入中读取一行文本，然后针对该行的数据执行程序脚本，但有时可能需要**在处理数据前运行一些脚本命令**，这就需要使用 BEGIN 关键字。

BEGIN 会强制 awk 在读取数据前执行该关键字后指定的脚本命令。

#### awk END关键字

和 BEGIN 关键字相对应，END 关键字允许我们指定一些脚本命令，awk 会在**读完数据后**执行它们。



